# Cursor Rules for VS Extension 001 - Database Client

## Project Overview
This is a database client extension for VS Code/Cursor with AI-powered features.

## ğŸ¤– Cursor AI Integration

This extension is designed to work seamlessly with Cursor AI. You can edit SQL queries by modifying the session file.

### SQL Session File

**Location:** `.vscode/db-client-session.json`

**What it contains:**
- Current SQL query in the editor
- Active database connection ID
- Last update timestamp

**How Cursor AI can help:**

1. **Edit SQL directly in session file:**
   - User can ask: "Modify the SQL in the session to add a WHERE clause"
   - Cursor AI edits `.vscode/db-client-session.json`
   - Changes reflect in Database Client UI immediately (via file watcher)

2. **Generate optimized SQL:**
   - User can ask: "Rewrite this SQL with display options"
   - Cursor AI updates the `sqlInput` field with formatted SQL

3. **Add display options:**
   - User can ask: "Add display formatting to this query"
   - Cursor AI inserts `/** @column ... */` comments

**Example session file:**
```json
{
  "connectionId": "production-db",
  "isConnected": false,
  "sqlInput": "/**\n * @column amount align=right format=number comma=true\n */\nSELECT amount FROM orders",
  "lastUpdated": "2025-12-28T12:00:00.000Z"
}
```

**Workflow:**
```
User: "Add display options to format the 'price' column"
  â†“
Cursor AI: Edits .vscode/db-client-session.json
  â†“
File watcher: Detects change
  â†“
UI: Updates automatically
  â†“
User: Sees formatted SQL in Database Client
```

## SQL Display Options Feature

This extension supports custom display formatting through SQL comments.

### Syntax
Use `/** ... */` comments at the beginning or end of SQL queries with `@column` directives:

```sql
/**
 * @column <column_name> <option>=<value> <option>=<value> ...
 */
SELECT ...
```

### Supported Options

#### Text Alignment
- `align=left|center|right` - Text alignment in table cells

#### Number Formatting
- `format=number` - Format as number
- `comma=true|false` - Add thousands separator (1,234,567)
- `decimal=N` - Number of decimal places (e.g., decimal=2 â†’ 123.45)

#### Datetime Formatting
- `format=datetime` - Format as datetime
- `pattern=<format>` - Date format pattern
  - `yyyy` = 4-digit year
  - `MM` = 2-digit month
  - `dd` = 2-digit day
  - `HH` = 2-digit hour (24h)
  - `mm` = 2-digit minute
  - `ss` = 2-digit second
  - Example: `pattern=yyyy/MM/dd_HH:mm:ss`

#### Column Styling
- `width=<size>` - Column width (e.g., `width=200px`)
- `color=<color>` - Text color (e.g., `color=#ff0000`)
- `bg=<color>` or `backgroundColor=<color>` - Background color
- `bold=true` - Make text bold

### Examples

#### Financial Report
```sql
/**
 * @column åº—èˆ—å width=150px
 * @column å£²ä¸Š align=right format=number comma=true
 * @column å‰å¹´æ¯” align=right format=number decimal=1
 * @column æ›´æ–°æ—¥æ™‚ format=datetime pattern=yyyy/MM/dd_HH:mm
 */
SELECT åº—èˆ—å, å£²ä¸Š, å‰å¹´æ¯”, æ›´æ–°æ—¥æ™‚ FROM sales_report;
```

#### Styled Table
```sql
/**
 * @column ID align=right
 * @column ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ color=#00ff00 bold=true
 * @column é‡‘é¡ align=right format=number comma=true decimal=2
 * @column ä½œæˆæ—¥æ™‚ format=datetime pattern=yyyy/MM/dd
 */
SELECT ID, ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹, é‡‘é¡, ä½œæˆæ—¥æ™‚ FROM orders;
```

### Implementation Details
- Parser: `src/sqlCommentParser.ts`
- Options are extracted in `DatabaseClientPanel._handleExecuteQuery()`
- Formatting applied in Webview's `handleQueryResult()` function
- Number formatting uses `formatValue()` helper
- Datetime formatting uses `formatDateTime()` helper
- Styling uses `generateColumnStyle()` helper

## Coding Guidelines

### TypeScript
- Use strict typing
- Prefer interfaces over types for extensibility
- Document public APIs with JSDoc comments

### SQL Validation
- Only read-only queries allowed (SELECT, SHOW, DESC, EXPLAIN)
- INSERT, UPDATE, DELETE are blocked by `SqlValidator`

### Session Persistence
- SQL input auto-saved to `.vscode/db-client-session.json`
- File watcher syncs external changes (Cursor edits)
- Query results auto-saved to `query-results/` directory

### Internationalization
- English is default language
- Japanese is supported
- Translation files: `src/i18n/en.json`, `src/i18n/ja.json`
- Schema documents adapt to VS Code language setting

## File Structure
- `src/databaseClientPanel.ts` - Main Webview panel
- `src/database/` - Database connection layer
- `src/i18n/` - Translation files
- `src/sqlCommentParser.ts` - Display options parser
- `src/sqlFormatter.ts` - SQL beautifier
- `src/sqlValidator.ts` - SQL security validator

## When Helping with SQL Queries

1. Always suggest using display options for better presentation
2. Use `align=right` for numeric columns
3. Use `format=number comma=true` for currency/large numbers
4. Use `format=datetime pattern=...` for timestamps
5. Keep column names in original language (often Japanese)
6. Remember this is a read-only client (no INSERT/UPDATE/DELETE)

